## 抽象语法树和字节码

### 抽象语法树

抽象语法树（Abstract Syntax Tree 或者缩写为 AST）其实是 **源代码的抽象语法结构的树状表现形式**。

树上的每个节点都表示源代码中的一种结构。但是抽象语法树并不能真正的描述程序语言中的细节，因为他是抽象的，只代表逻辑。


#### 举例说明抽象语法树

要明白一个问题，因为抽象语法树中不会有任何关于程序语言的细节，所以理论上，不同程序语言写出来的代码，生成的抽象语法树是一致的。

举个例子，对于“电脑”这个实体而言：

- 中文用“电脑”表示
- 英文用“computer”表示
- 德文用“Der computer”

不同单词的表示是同一个物体。类比到抽象语法树中来，不同的程序语言（C语言、lisp语言、JavaScript语言等）写同样一个`(1+2)*3`的例子，最终转换成抽象语法树后，他们的结构是一致的。抽象语法树可以用来描述程序运行规则，这个规则对应我们的现实世界。在现实世界中，括号里的1+2运算优先级大于乘号，所以先计算1+2，然后再用二者之和去乘3。而这个过程在不同语言中，写法可能就不太一样了。

JavaScript语言版：` ( 1 + 2 ) * 3`

Lisp语言版： ` ( * (+ 1 2) 3) `

![JavaScript's Abstract Syntax Tree](http://p9jftl6n6.bkt.clouddn.com/JavsScript%27s%20AST.png)



#### 抽象语法树的作用

抽象语法树作为程序的一种中间表示形式，是进行语义分析、代码优化的基础。
![Abstract Syntax Tree](http://p9jftl6n6.bkt.clouddn.com/Abstract%20Syntax%20Tree.png)

对开发者而言，AST的作用就是可以精准的定位到代码的任何地方，它就像是你的手术刀，对代码进行一系列的操作。

- 代码语法的检查、代码风格的检查、代码的格式化、代码的高亮、代码错误提示、代码自动补全等等 
    - 如JSLint、JSHint对代码错误或风格的检查，发现一些潜在的错误
    - IDE的错误提示、格式化、高亮、自动补全等等
- 代码混淆压缩 
    - UglifyJS2等
- 优化变更代码，改变代码结构使达到想要的结构 
    - 代码打包工具webpack、rollup等等
    - CommonJS、AMD、CMD、UMD等代码规范之间的转化
    - CoffeeScript、TypeScript、JSX等转化为原生Javascript


### 字节码

理解字节码，需要先理解机器码的概念。

机器码（machine code）又叫机器指令，是计算机可以直接读取执行的数据，并且执行速度最快（因为不需要再进行编译转换等操作）。

而不同体系的机器（32位、64位、OS）的执行指令是不一致的，所以同样一套程序转换成机器码后，在不同的机器种的机器码是不一致的。

这时候就该字节码出场了！！！

字节码（Bytecode）是一种包含执行程序、由一序列 op 代码/数据对 组成的二进制文件。字节码是一种中间码，它比机器码更抽象，需要直译器转译后才能成为机器码的中间代码。

通常情况下它是已经经过编译，但与特定机器码无关。字节码通常不像源码一样可以让人阅读，而是编码后的数值常量、引用、指令等构成的序列。

字节码主要为了实现特定软件运行和软件环境、与硬件环境无关。字节码的实现方式是通过编译器和虚拟机器。编译器将源码编译成字节码，特定平台上的虚拟机器将字节码转译为可以直接执行的指令。字节码的典型应用为Java bytecode。

字节码是一种中间状态（中间码）的二进制代码（文件）。需要直译器转译后才能成为机器码。


机器码是机器指令，比汇编语言更难懂，因为它比汇编语言更接近底层硬件。

字节码在实际当中的应用有Java(Java程序被转成字节码，借助它的虚拟机JVM可以在不同得平台上运行)。


【参考资料】

[Abstract Syntax Tree 抽象语法树简介](https://div.io/topic/1994?utm_source=tuicool&utm_medium=referral)

[机器码和字节码](https://www.cnblogs.com/qiumingcheng/p/5400265.html)