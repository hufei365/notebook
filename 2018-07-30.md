> Sometimes life is too hard to be alone, and sometimes life is too good to be alone.


## JavaScript的模块机制

曾经，JavaScript只是用于浏览器端的表单验证和动画效果实现，谈不上什么复杂的程序业务逻辑。程序还没复杂到需要切割成不同的业务模块，所以，模块化对于JavaScript而言，听听就行了。

But（对，听别人说啥，就只听but后面的话就可以了），随着Web2.0的出现，JavaScript被赋予越来越多的任务，它的职责范围不断扩大， 带来的也是程序复杂性的增长。面对没有模块机制的JavaScript，开发者就抓瞎了。

### CommonJS规范
作为最早提出且被大家认可的规范，它主要在Node上发光发热。

Node主体采用了CommonJS的规范，并在其基础上根据自己的实际需求进行了调整。

### Node引入模块

在Node中，引入模块分为三个步骤：

- 路径分析
- 文件定位
- 编译执行


Node中的模块分为两类：

- 核心模块（Node中内嵌的，比如`fs`）
- 文件模块（开发者自己编写的）


核心模块在Node源码编译的过程中，编译进了二进制文件。所以在Node进程启动的时候，部分核心模块就已经被直接加载到了内存当中。

文件模块是在运行的时候，动态加载。需要进行路径分析，文件定位 和 编译执行。


Node加载模块时，优先从缓存中加载，如果缓存中不存在该模块，才会按照上述的三个步骤进行模块加载。

模块标识符在Node中，主要有以下几类：

- 核心模块，比如`fs`, `http`等
- 以`.` 或 `..`开头的相对路径文件模块
- 以`/` 开头的绝对路径文件模块
- 非路径形式的文件模块；

这几类模块的加载速度是依次降低的。

### 模块编译
编译和执行是引入文件模块的最后一个阶段。

- `.js`文件
- `.node`文件
- `.json`文件